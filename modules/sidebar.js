import{getFileList,getCurrentIndex,getFileIconState}from"./fileState.js";export function initSidebar({onFileSelected:e}={}){const t=document.getElementById("sidebar"),n=document.getElementById("toggleSidebarBtn"),l=(document.getElementById("sidebarIcon"),document.getElementById("fileList")),a=document.getElementById("searchInput"),i=(document.getElementById("currentFilePath"),document.getElementById("fileCount"));function o(t=""){const n=getFileList(),a=getCurrentIndex();if(i){const e=`(Total: ${n.length.toLocaleString()} files)`;i.textContent=e}let o=null;l.innerHTML="",n.forEach(((n,i)=>{if(t&&!n.name.toLowerCase().includes(t))return;const s=document.createElement("li");s.style.padding="3px 0",s.style.cursor="pointer",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="space-between";const c=n.name.replace(/\.wav$/i,""),d=document.createElement("span"),r=document.createElement("i");r.className="fa-regular fa-file-audio",r.style.marginRight="6px",d.appendChild(r);const m=document.createTextNode(c);d.appendChild(m),s.appendChild(d);const u=document.createElement("span"),p=getFileIconState(i);if(p.trash){const e=document.createElement("i");e.className="fa-solid fa-trash",e.style.color="gray",e.style.marginleft="4px",u.appendChild(e)}if(p.star){const e=document.createElement("i");e.className="fa-solid fa-star",e.style.color="#FFD700",e.style.marginLeft="4px",u.appendChild(e)}if(p.question){const e=document.createElement("i");e.className="fa-solid fa-question",e.style.color="red",e.style.marginLeft="4px",u.appendChild(e)}s.appendChild(u),s.addEventListener("click",(()=>{"function"==typeof e&&e(i)})),i===a&&(s.style.fontWeight="bold",s.style.color="#007bff",o=s),l.appendChild(s)})),o&&requestAnimationFrame((()=>{o.scrollIntoView({block:"center",behavior:"smooth"})}))}return n.addEventListener("click",(()=>{t.classList.toggle("collapsed");const e=t.classList.contains("collapsed");n.title=e?"Open File List":"Collapse File List"})),a.addEventListener("input",(()=>{o(a.value.trim().toLowerCase())})),{refresh:(e,t=!0)=>{!function(e){document.getElementById("fileNameText").textContent=e||"Upload wav file(s)"}(e),t&&(a.value=""),o(a.value.trim().toLowerCase())}}}