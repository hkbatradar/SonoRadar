export function initFreqContextMenu({viewerId:e,wrapperId:t="viewer-wrapper",containerId:n="spectrogram-only",spectrogramHeight:l=800,getDuration:o,getFreqRange:a,autoId:r}){const s=document.getElementById(e),i=document.getElementById(t),d=document.getElementById(n);if(!s||!i)return null;const c=document.createElement("div");c.id="freq-context-menu",c.className="freq-context-menu",c.style.display="none";const u={start:"Start freq.",end:"End freq.",high:"High freq.",low:"Low freq.",knee:"Knee freq.",heel:"Heel freq.",cfStart:"CF start",cfEnd:"CF end"},f=Object.keys(u);let m=null;f.forEach((e=>{const t=document.createElement("div");t.className="freq-menu-item",t.textContent=u[e],t.dataset.key=e,t.addEventListener("click",(()=>{if(t.classList.contains("disabled"))return;const n=m===e;y(),n?r&&"function"==typeof r.removeMarker&&r.removeMarker(e):r&&"function"==typeof r.setMarkerAt&&r.setMarkerAt(e,p,g)})),c.appendChild(t)})),document.body.appendChild(c);let p=0,g=0;function y(){c.style.display="none",m=null}return i.addEventListener("contextmenu",(e=>{if(!document.body.classList.contains("autoid-open"))return;e.preventDefault(),e.stopImmediatePropagation();let t,n,y=null;if(e.target.classList.contains("freq-marker"))y=e.target.dataset.key,t=parseFloat(e.target.dataset.freq),n=parseFloat(e.target.dataset.time);else{const r=i.getBoundingClientRect(),c=e.clientX-r.left,u=e.clientY-r.top,f=s.scrollLeft||0,{min:m,max:p}=a();t=(1-u/l)*(p-m)+m,n=(c+f)/d.scrollWidth*o()}!function(e,t,n,l,o=null){p=n,g=l,m=o,f.forEach((e=>{const t=c.querySelector(`[data-key="${e}"]`),n=!r||"function"==typeof r.isFieldEnabled&&r.isFieldEnabled(e);t.classList.toggle("disabled",!n),t.style.display=n?"block":"none",e===m?(t.textContent=`Delete ${u[e]}`,t.classList.add("delete")):(t.textContent=u[e],t.classList.remove("delete"))})),c.style.display="block",c.style.left=`${e}px`,c.style.top=`${t}px`;const a=c.getBoundingClientRect(),s=i.getBoundingClientRect();if(a.right>s.right){const t=e-a.width;c.style.left=`${Math.max(s.left,t)}px`}}(e.clientX,e.clientY,t,n,y)})),document.addEventListener("mousedown",(e=>{0===e.button&&"none"!==c.style.display&&(c.contains(e.target)||y())})),{hide:y}}