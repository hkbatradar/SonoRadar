export function initFreqContextMenu({viewerId:e,wrapperId:t="viewer-wrapper",containerId:n="spectrogram-only",spectrogramHeight:o=800,getDuration:l,getFreqRange:i,autoId:r}){const s=document.getElementById(e),a=document.getElementById(t),c=document.getElementById(n);if(!s||!a)return null;const d=document.createElement("div");d.id="freq-context-menu",d.className="freq-context-menu",d.style.display="none";const u={start:"Start freq.",end:"End freq.",high:"High freq.",low:"Low freq.",knee:"Knee freq.",heel:"Heel freq.",cfStart:"CF start",cfEnd:"CF end"},f=Object.keys(u);let m=null;f.forEach((e=>{const t=document.createElement("div");t.className="freq-menu-item",t.textContent=u[e],t.dataset.key=e,t.addEventListener("click",(()=>{if(t.classList.contains("disabled"))return;const n=m===e;y(),n?r&&"function"==typeof r.removeMarker&&r.removeMarker(e):r&&"function"==typeof r.setMarkerAt&&r.setMarkerAt(e,g,p)})),d.appendChild(t)})),document.body.appendChild(d);let g=0,p=0;function y(){d.style.display="none",m=null}return a.addEventListener("contextmenu",(e=>{if(!document.body.classList.contains("autoid-open"))return;if(e.target.closest("#zoom-controls"))return;const t=s.getBoundingClientRect(),n=e.clientX-t.left,y=e.clientY-t.top,h=c.scrollWidth>s.clientWidth?0:20,x=y>s.clientHeight-h,q=s.scrollHeight>s.clientHeight&&n>s.clientWidth;if(x||q)return;e.preventDefault(),e.stopImmediatePropagation();let E,k,b=null;if(e.target.classList.contains("freq-marker"))b=e.target.dataset.key,E=parseFloat(e.target.dataset.freq),k=parseFloat(e.target.dataset.time);else{const e=s.scrollLeft||0,{min:t,max:r}=i();E=(1-y/o)*(r-t)+t,k=(n+e)/c.scrollWidth*l()}!function(e,t,n,o,l=null){g=n,p=o,m=l,f.forEach((e=>{const t=d.querySelector(`[data-key="${e}"]`),n=!r||"function"==typeof r.isFieldEnabled&&r.isFieldEnabled(e);t.classList.toggle("disabled",!n),t.style.display=n?"block":"none",e===m?(t.textContent=`Delete ${u[e]}`,t.classList.add("delete")):(t.textContent=u[e],t.classList.remove("delete"))})),d.style.display="block",d.style.left=`${e}px`,d.style.top=`${t}px`;let i=d.getBoundingClientRect();const s=a.getBoundingClientRect();if(i.bottom>s.bottom){const e=t-i.height;d.style.top=`${Math.max(s.top,e)}px`,i=d.getBoundingClientRect()}if(i.right>s.right){const t=e-i.width;d.style.left=`${Math.max(s.left,t)}px`}}(e.clientX,e.clientY,E,k,b)})),document.addEventListener("mousedown",(e=>{0===e.button&&"none"!==d.style.display&&(d.contains(e.target)||y())})),{hide:y}}