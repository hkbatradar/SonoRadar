import{getFileList,getCurrentIndex,getFileIconState}from"./fileState.js";export function initSidebar({onFileSelected:e}={}){const t=document.getElementById("sidebar"),n=document.getElementById("toggleSidebarBtn"),l=(document.getElementById("sidebarIcon"),document.getElementById("fileList")),a=document.getElementById("searchInput"),s=(document.getElementById("currentFilePath"),document.getElementById("fileCount"));function i(t=""){const n=getFileList(),a=getCurrentIndex();if(s){const e=`(Total: ${n.length.toLocaleString()} files)`;s.textContent=e}let i=null;l.innerHTML="",n.forEach(((n,s)=>{if(t&&!n.name.toLowerCase().includes(t))return;const o=document.createElement("li");o.style.padding="3px 0",o.style.cursor="pointer",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="space-between",o.style.flexWrap="nowrap";const c=n.name.replace(/\.wav$/i,""),r=document.createElement("span");r.style.display="flex",r.style.alignItems="center",r.style.flexGrow="1",r.style.minWidth="0";const d=document.createElement("i");d.className="fa-regular fa-file-audio",d.style.marginRight="6px",r.appendChild(d);const m=document.createElement("span");m.className="fileNameText",m.textContent=c,r.appendChild(m),o.appendChild(r);const p=document.createElement("span");p.style.display="flex",p.style.flexShrink="0",p.style.whiteSpace="nowrap";const f=getFileIconState(s);if(f.trash){const e=document.createElement("i");e.className="fa-solid fa-trash",e.style.color="gray",e.style.marginLeft="4px",p.appendChild(e)}if(f.star){const e=document.createElement("i");e.className="fa-solid fa-star",e.style.color="#FFD700",e.style.marginLeft="4px",p.appendChild(e)}if(f.question){const e=document.createElement("i");e.className="fa-solid fa-question",e.style.color="red",e.style.marginLeft="4px",p.appendChild(e)}o.appendChild(p),o.addEventListener("click",(()=>{"function"==typeof e&&e(s)})),s===a&&(o.style.fontWeight="bold",o.style.color="#007bff",i=o),l.appendChild(o)})),i&&requestAnimationFrame((()=>{i.scrollIntoView({block:"center",behavior:"smooth"})}))}return n.addEventListener("click",(()=>{t.classList.toggle("collapsed");const e=t.classList.contains("collapsed");n.title=e?"Open File List":"Collapse File List"})),a.addEventListener("input",(()=>{i(a.value.trim().toLowerCase())})),{refresh:(e,t=!0)=>{!function(e){document.getElementById("fileNameText").textContent=e||"Upload wav file(s)"}(e),t&&(a.value=""),i(a.value.trim().toLowerCase())}}}