import{getCurrentIndex,getFileNote,setFileNote}from"./fileState.js";export function initTagControl(){const e=document.getElementById("toggleTagModeBtn"),t=document.getElementById("tag-panel"),n=document.createElement("button");n.id="editTagsBtn",n.textContent="Edit Tags",n.className="flat-icon-button";const a=[];["JP","LP","CP","KP","LBB","GBB","CN","LYB","HLB","ALB","CHB","IHB","LHB","GBW","LBW","ABW","HM","RBFM","CM","WM","BTB","WFTB"].forEach((e=>{const n=document.createElement("input");n.type="text",n.className="tag-button",n.value=e,n.readOnly=!0,n.addEventListener("keydown",(e=>{","===e.key&&(e.preventDefault(),alert("Commas are not allowed in tag names."))})),n.addEventListener("input",(e=>{e.target.value.includes(",")&&(e.target.value=e.target.value.replace(/,/g,""),alert("Commas are not allowed in tag names."))})),n.addEventListener("click",(()=>function(e){if(!e.readOnly)return;const t=getCurrentIndex();if(t<0)return;const n=e.value.trim();let a=getFileNote(t);const i=a?a.split(",").map((e=>e.trim())).filter((e=>e)):[],s=i.indexOf(n);s>=0?(i.splice(s,1),e.classList.remove("active")):(i.push(n),e.classList.add("active"));const d=i.join(", ");setFileNote(t,d);const o=document.querySelectorAll("#fileList li");if(t>=0&&t<o.length){const e=o[t].querySelector(".file-note-input");e&&(e.value=d)}}(n))),t.appendChild(n),a.push(n)})),t.appendChild(n);let i=!1,s=!1;function d(){const e=getCurrentIndex(),t=(e>=0?getFileNote(e):"").split(",").map((e=>e.trim())).filter((e=>e));a.forEach((e=>{t.includes(e.value.trim())?e.classList.add("active"):e.classList.remove("active")}))}return n.addEventListener("click",(()=>{s=!s,s?(n.textContent="Confirm",n.classList.add("editing-mode"),a.forEach((e=>{e.readOnly=!1,e.classList.add("editing")}))):(n.textContent="Edit Tags",n.classList.remove("editing-mode"),a.forEach((e=>{e.readOnly=!0,e.classList.remove("editing")})),d())})),e.addEventListener("click",(()=>{document.body.classList.contains("tag-mode-active")?(document.body.classList.remove("tag-mode-active"),e.classList.remove("tag-active"),!i&&document.getElementById("sidebar").classList.contains("edit-mode")&&document.getElementById("toggleEditBtn").click()):(document.body.classList.add("tag-mode-active"),e.classList.add("tag-active"),i=document.getElementById("sidebar").classList.contains("edit-mode"),i||document.getElementById("toggleEditBtn").click(),d())})),document.addEventListener("file-loaded",d),{updateTagButtonStates:d}}