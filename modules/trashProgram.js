import{getTrashFileNames}from"./fileState.js";import{showMessageBox}from"./messageBox.js";export function initTrashProgram({buttonId:e="trashProgramBtn"}={}){const t=document.getElementById(e);function o(){const e=getTrashFileNames();if(0===e.length)return;const t=[];t.push("@echo off"),t.push("setlocal EnableDelayedExpansion"),t.push(`set COUNT=${e.length}`),t.push(`if not exist "${e[0]}" (`),t.push('  powershell -NoProfile -Command "Add-Type -AssemblyName Microsoft.VisualBasic; [Microsoft.VisualBasic.Interaction]::MsgBox((\\"Cannot find the target .wav files.`nPlease place this batch file in the folder containing the .wav files and try again.\\"),\\"OKOnly,Critical\\",\\"File Not Found\\")"'),t.push("  exit /b"),t.push(")"),t.push("echo Listing !COUNT! .wav file(s) to be deleted:"),e.forEach((e=>{t.push(`echo ${e}`)})),t.push("echo."),t.push('powershell -NoProfile -Command "Add-Type -AssemblyName Microsoft.VisualBasic; $res=[Microsoft.VisualBasic.Interaction]::MsgBox((\\"This will delete !COUNT! wav file(s). Continue?\\"),\\"OkCancel,Exclamation\\",\\"Confirm Delete\\"); if ($res -ne \\"Ok\\") { exit 0 }"'),t.push("set DELETED=0"),t.push("for %%F in ("),e.forEach((e=>{t.push(`"${e}"`)})),t.push(") do ("),t.push('  if exist "%%F" ('),t.push('    del "%%F"'),t.push("    if not errorlevel 1 set /a DELETED+=1"),t.push("  )"),t.push(")"),t.push("echo."),t.push('powershell -NoProfile -Command "Add-Type -AssemblyName Microsoft.VisualBasic; [Microsoft.VisualBasic.Interaction]::MsgBox((\\"Deleted !DELETED! wav file(s).\\"),\\"OKOnly,Information\\",\\"Delete Done\\")"'),t.push("endlocal");const o=new Blob([t.join("\r\n")],{type:"application/octet-stream"}),s=URL.createObjectURL(o),a=document.createElement("a");a.href=s,a.download="delete_trash_files.bat",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)}t?t.addEventListener("click",(()=>{0!==getTrashFileNames().length&&showMessageBox({title:"Auto-trash delete program",message:"A batch (.bat) program will be generated to delete the .wav files marked as Trash.\n\nTo proceed:\n1. Move the .bat file to the folder containing those .wav files.\n2. Run the .bat file from that folder to complete the deletion.",confirmText:"Download",cancelText:"Cancel",onConfirm:o})})):console.warn("[trashProgram] Button not found.")}