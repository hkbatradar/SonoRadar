import{getFileList,getCurrentIndex,getFileIconState,getFileNote,setFileNote,toggleFileIcon}from"./fileState.js";export function initSidebar({onFileSelected:e}={}){const t=document.getElementById("sidebar"),n=document.getElementById("toggleSidebarBtn"),l=(document.getElementById("sidebarIcon"),document.getElementById("fileList")),a=document.getElementById("searchInput"),o=document.getElementById("toggleEditBtn"),s=(document.getElementById("currentFilePath"),document.getElementById("fileCount"));let i=!1;function c(t="",n=!0){const a=getFileList(),o=getCurrentIndex();if(s){const e=`(Total: ${a.length.toLocaleString()} files)`;s.textContent=e}let i=null;l.innerHTML="",a.forEach(((n,a)=>{if(t&&!n.name.toLowerCase().includes(t))return;const s=document.createElement("li");s.className="sidebar-item";const d=n.name.replace(/\.wav$/i,""),r=document.createElement("span");r.className="sidebar-left";const m=document.createElement("i");m.className="fa-regular fa-file-audio sidebar-file-icon",r.appendChild(m);const u=document.createElement("span");u.className="fileNameText",u.textContent=d,r.appendChild(u),s.appendChild(r);const g=document.createElement("span");g.className="sidebar-right";const p=document.createElement("span");p.className="sidebar-flags";const f=getFileIconState(a),E=document.createElement("i");E.className="fa-solid fa-trash flag-icon",E.title="Mark as Trash (Delete)";const L="gray";E.style.color=f.trash?L:"#ccc",E.addEventListener("mouseenter",(()=>{f.trash||(E.style.color=L)})),E.addEventListener("mouseleave",(()=>{f.trash||(E.style.color="#ccc")})),E.addEventListener("click",(e=>{e.stopPropagation(),toggleFileIcon(a,"trash"),c(t,!1)})),p.appendChild(E);const v=document.createElement("i");v.className="fa-solid fa-star flag-icon",v.title="Mark as Star ( * button)";const h="#FFD700";v.style.color=f.star?h:"#ccc",v.addEventListener("mouseenter",(()=>{f.star||(v.style.color=h)})),v.addEventListener("mouseleave",(()=>{f.star||(v.style.color="#ccc")})),v.addEventListener("click",(e=>{e.stopPropagation(),toggleFileIcon(a,"star"),c(t,!1)})),p.appendChild(v);const y=document.createElement("i");y.className="fa-solid fa-question flag-icon",y.title="Mark as Question ( ? button)";y.style.color=f.question?"red":"#ccc",y.addEventListener("mouseenter",(()=>{f.question||(y.style.color="red")})),y.addEventListener("mouseleave",(()=>{f.question||(y.style.color="#ccc")})),y.addEventListener("click",(e=>{e.stopPropagation(),toggleFileIcon(a,"question"),c(t,!1)})),p.appendChild(y),g.appendChild(p);const C=document.createElement("input");C.type="text",C.className="file-note-input",C.value=getFileNote(a),C.addEventListener("click",(e=>e.stopPropagation())),C.addEventListener("input",(e=>{setFileNote(a,e.target.value)})),g.appendChild(C),s.appendChild(g),r.addEventListener("click",(()=>{"function"==typeof e&&e(a)})),a===o&&(s.style.fontWeight="bold",s.style.color="#007bff",i=s),l.appendChild(s)})),i&&n&&requestAnimationFrame((()=>{i.scrollIntoView({block:"center",behavior:"smooth"})}))}return n.addEventListener("click",(()=>{t.classList.toggle("collapsed");const e=t.classList.contains("collapsed");n.title=e?"Open File List":"Collapse File List"})),o.addEventListener("click",(()=>{i=!i,t.classList.toggle("edit-mode",i)})),a.addEventListener("input",(()=>{c(a.value.trim().toLowerCase())})),{refresh:(e,t=!0)=>{!function(e){document.getElementById("fileNameText").textContent=e||"Upload wav file(s)"}(e),t&&(a.value=""),c(a.value.trim().toLowerCase())}}}