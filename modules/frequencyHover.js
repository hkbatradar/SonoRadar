export function initFrequencyHover({viewerId:e,wrapperId:t="viewer-wrapper",hoverLineId:n,hoverLineVId:o,freqLabelId:l,spectrogramHeight:i=800,spectrogramWidth:s=1024,maxFrequency:d=128,minFrequency:r=0,totalDuration:a=1e3,getZoomLevel:c,getDuration:u}){const p=document.getElementById(e),m=document.getElementById(t),h=document.getElementById(n),y=document.getElementById(o),f=document.getElementById(l),v=document.getElementById("fixed-overlay"),g=document.getElementById("zoom-controls"),x=document.getElementById("spectrogram-only"),w=[],b=[],L=5;let E=!1,F=!1,$=!1,C=!1,B=0,I=0,k=null,z=null,q=null;const H=()=>{h.style.display="none",y.style.display="none",f.style.display="none"},R=e=>{if(z=e.clientX,q=e.clientY,E||$)return void H();const t=p.getBoundingClientRect(),n=e.clientX-t.left,o=e.clientY-t.top;if(o>p.clientHeight-2)return void H();const l=p.scrollLeft||0,s=(1-o/i)*(d-r)+r,a=(n+l)/x.scrollWidth*u();h.style.top=`${o}px`,h.style.display="block",y.style.left=`${n}px`,y.style.display="block";let c;p.clientWidth-n<120?(f.style.transform="translate(-100%, -50%)",c=n-12+"px"):(f.style.transform="translate(0, -50%)",c=`${n+12}px`),f.style.top=`${o}px`,f.style.left=c,f.style.display="block",f.textContent=`${s.toFixed(1)} kHz   ${(1e3*a).toFixed(1)} ms`};function M(){const e=u()*c(),t=d-r;b.forEach((n=>{const{startTime:o,endTime:l,Flow:s,Fhigh:d}=n.data,a=o/u()*e,c=(l-o)/u()*e,p=(1-(d-r)/t)*i,m=(d-s)/t*i;n.rect.style.left=`${a}px`,n.rect.style.top=`${p}px`,n.rect.style.width=`${c}px`,n.rect.style.height=`${m}px`;const h=a+c+10;n.tooltip.style.left=`${h}px`,n.tooltip.style.top=`${p}px`,function(e,t,n,o,l){const{data:i,tooltip:s}=e,d=i.Flow,r=i.Fhigh,a=r-d,c=i.endTime-i.startTime;s.querySelector(".fhigh").textContent=r.toFixed(1),s.querySelector(".flow").textContent=d.toFixed(1),s.querySelector(".bandwidth").textContent=a.toFixed(1),s.querySelector(".duration").textContent=(1e3*c).toFixed(1)}(n)}))}return p.addEventListener("mousemove",R),m.addEventListener("mouseleave",H),p.addEventListener("mouseenter",(()=>p.classList.add("hide-cursor"))),p.addEventListener("mouseleave",(()=>p.classList.remove("hide-cursor"))),g&&(g.addEventListener("mouseenter",(()=>{E=!0,H()})),g.addEventListener("mouseleave",(()=>{E=!1}))),p.addEventListener("mousedown",(e=>{if(F||$)return;if(0!==e.button)return;const t=p.getBoundingClientRect();B=e.clientX-t.left+p.scrollLeft,I=e.clientY-t.top,I>p.clientHeight-2||(C=!0,E=!0,H(),k=document.createElement("div"),k.style.position="absolute",k.style.border="1px solid black",k.style.backgroundColor="rgba(0,0,0,0.05)",k.style.zIndex="20",p.appendChild(k))})),p.addEventListener("mousemove",(e=>{if(!C)return;const t=p.getBoundingClientRect(),n=e.clientX-t.left+p.scrollLeft,o=e.clientY-t.top,l=Math.min(n,B),i=Math.min(o,I),s=Math.abs(n-B),d=Math.abs(o-I);k.style.left=`${l}px`,k.style.top=`${i}px`,k.style.width=`${s}px`,k.style.height=`${d}px`})),p.addEventListener("mouseup",(e=>{if(!C)return;C=!1;const t=k.getBoundingClientRect(),n=p.getBoundingClientRect(),o=t.left-n.left+p.scrollLeft,l=t.top-n.top,s=t.width,a=t.height;if(s<=3||a<=3)return p.removeChild(k),k=null,E=!1,void R(e);const m=(1-(l+a)/i)*(d-r)+r,h=(1-l/i)*(d-r)+r,y=h-m,f=u()*c(),v=o/f*u(),g=(o+s)/f*u();!function(e,t,n,o,l,s,a,m,h,y,f){const v=document.createElement("div");v.className="draggable-tooltip",v.style.position="absolute",v.style.left=`${e+n+10}px`,v.style.top=`${t}px`,v.style.zIndex="30",v.style.padding="6px 10px",v.style.background="white",v.style.border="1px solid black",v.style.fontSize="12px",v.style.fontFamily="Noto Sans HK",v.style.boxShadow="2px 2px 5px rgba(0,0,0,0.2)",v.style.cursor="move",v.innerHTML=`\n      <div><b>F.high:</b> <span class="fhigh">${l.toFixed(1)}</span> kHz</div>\n      <div><b>F.Low:</b> <span class="flow">${s.toFixed(1)}</span> kHz</div>\n      <div><b>Bandwidth:</b> <span class="bandwidth">${a.toFixed(1)}</span> kHz</div>\n      <div><b>Duration:</b> <span class="duration">${(1e3*m).toFixed(1)}</span> ms</div>\n      <div style="position:absolute; top:2px; right:6px; cursor:pointer;" class="close-btn">Ã—</div>\n    `,v.addEventListener("mouseenter",(()=>{F=!0,E=!0,H()})),v.addEventListener("mouseleave",(()=>{F=!1,E=!1})),p.appendChild(v);const g={data:{startTime:y,endTime:f,Flow:s,Fhigh:l},rect:h,tooltip:v};b.push(g),function(e){let t,n,o=!1;e.addEventListener("mousedown",(l=>{if(l.target.classList.contains("close-btn"))return;o=!0;const i=e.getBoundingClientRect();t=l.clientX-i.left,n=l.clientY-i.top})),window.addEventListener("mousemove",(l=>{if(!o)return;const i=p.getBoundingClientRect(),s=l.clientX-i.left+p.scrollLeft-t,d=l.clientY-i.top-n;e.style.left=`${s}px`,e.style.top=`${d}px`})),window.addEventListener("mouseup",(()=>{o=!1}))}(v),function(e){const t=e.rect;let n=!1,o=null,l=null;t.addEventListener("mousemove",(e=>{if(C||n)return;const o=t.getBoundingClientRect(),l=e.clientX-o.left,i=e.clientY-o.top;let s="default";const d=l<L,r=l>o.width-L,a=i<L,c=i>o.height-L;d&&a||r&&c?s="nwse-resize":r&&a||d&&c?s="nesw-resize":d||r?s="ew-resize":(a||c)&&(s="ns-resize"),t.style.cursor=s})),t.addEventListener("mousedown",(s=>{if(n)return;const a=t.getBoundingClientRect(),m=s.clientX-a.left,h=s.clientY-a.top,y=m<L,f=m>a.width-L,v=h<L,g=h>a.height-L;if(o=y?"left":f?"right":null,l=v?"top":g?"bottom":null,!o&&!l)return;n=!0,$=!0,s.preventDefault();const x=t=>{if(!n)return;const s=p.getBoundingClientRect(),a=p.scrollLeft||0,m=t.clientX-s.left+a,h=t.clientY-s.top,y=u()*c(),f=d-r;if("left"===o){let t=m/y*u();t=Math.min(t,e.data.endTime-.001),e.data.startTime=t}if("right"===o){let t=m/y*u();t=Math.max(t,e.data.startTime+.001),e.data.endTime=t}if("top"===l){let t=(1-h/i)*f+r;t=Math.max(t,e.data.Flow+.1),e.data.Fhigh=t}if("bottom"===l){let t=(1-h/i)*f+r;t=Math.min(t,e.data.Fhigh-.1),e.data.Flow=t}M()},w=()=>{n=!1,$=!1,o=null,l=null,window.removeEventListener("mousemove",x),window.removeEventListener("mouseup",w)};window.addEventListener("mousemove",x),window.addEventListener("mouseup",w)}))}(g),v.querySelector(".close-btn").addEventListener("click",(()=>{const e=b.findIndex((e=>e.tooltip===v));-1!==e&&(p.removeChild(b[e].rect),p.removeChild(b[e].tooltip),b.splice(e,1)),F=!1,E=!1}))}(o,l,s,0,h,m,y,g-v,k,v,g),k=null,E=!1})),p.addEventListener("contextmenu",(e=>{if(F)return;e.preventDefault();const t=v.getBoundingClientRect(),n=(1-(e.clientY-t.top)/i)*(d-r)+r,o=w.findIndex((e=>Math.abs(e.freq-n)<1));if(-1!==o)v.removeChild(w[o].div),w.splice(o,1);else{if(w.length>=5)return;const e=Math.round((1-(n-r)/(d-r))*i),t=document.createElement("div");t.style.position="absolute",t.style.top=`${e}px`,t.style.left="0",t.style.width="100%",t.style.height="1px",t.style.background="red",t.style.zIndex="15",v.appendChild(t),w.push({freq:n,div:t})}})),{updateSelections:M,setFrequencyRange:(e,t)=>{r=e,d=t,M()},hideHover:H,refreshHover:()=>{null!==z&&null!==q&&R({clientX:z,clientY:q})}}}