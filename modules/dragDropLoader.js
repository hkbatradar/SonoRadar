import{extractGuanoMetadata}from"./guanoReader.js";import{setFileList}from"./fileState.js";export function initDragDropLoader({targetElementId:e,wavesurfer:t,spectrogramHeight:n,colorMap:a,onPluginReplaced:o,onFileLoaded:r,onBeforeLoad:d,onAfterLoad:i}){const l=document.getElementById(e),s=document.getElementById("drop-overlay");let c=null;function f(){s.style.display="none"}async function u(e){const n=Array.from(e).filter((e=>"audio/wav"===e.type||e.name.endsWith(".wav")));if(0===n.length)return void alert("Only .wav files are supported.");const a=n.sort(((e,t)=>e.name.localeCompare(t.name)));setFileList(a,0),await async function(e){if(!e)return;"function"==typeof d&&d(),"function"==typeof r&&r(e);const n=document.getElementById("fileNameText");n&&(n.textContent=e.name);const a=document.getElementById("guano-output");try{const t=await extractGuanoMetadata(e);a.textContent=t||"(No GUANO metadata found)"}catch(e){a.textContent="(Error reading GUANO metadata)"}const l=URL.createObjectURL(e);c&&URL.revokeObjectURL(c),c=l,await t.load(l),"function"==typeof o&&o();const s=t?.options?.sampleRate||256e3;document.getElementById("spectrogram-settings").textContent=`Sampling rate: ${s/1e3}kHz, FFT size: 1024, Overlap size: Auto, Hanning window`,"function"==typeof i&&i()}(a[0])}l.addEventListener("dragover",(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",s.style.display="flex"})),l.addEventListener("dragleave",(e=>{e.preventDefault(),f()})),l.addEventListener("drop",(e=>{e.preventDefault(),f(),u(e.dataTransfer.files)}))}