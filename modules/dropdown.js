export class Dropdown{constructor(e,t=[],{onChange:n}={}){this.button=e,this.items=t,this.onChange=n,this.menu=this._createMenu(),this.isOpen=!1,this.selectedIndex=-1,this._bindButton()}_createMenu(){const e=document.createElement("div");return e.className="dropdown-menu",e.tabIndex=-1,this.items.forEach(((t,n)=>{const s=document.createElement("div");s.className="dropdown-item",s.textContent=t.label??t,s.dataset.index=n,s.addEventListener("click",(()=>{this.select(n),this.close()})),e.appendChild(s)})),document.body.appendChild(e),e}_bindButton(){this.button.addEventListener("click",(e=>{e.stopPropagation(),this.toggle()})),this.button.addEventListener("keydown",(e=>{"ArrowDown"!==e.key&&"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.open())}))}_bindDocument(){this._docHandler=e=>{this.menu.contains(e.target)||e.target===this.button||this.close()},document.addEventListener("mousedown",this._docHandler),document.addEventListener("touchstart",this._docHandler),document.addEventListener("keydown",(e=>{this.isOpen&&("Escape"===e.key?this.close():"ArrowDown"===e.key?(this._move(1),e.preventDefault()):"ArrowUp"===e.key?(this._move(-1),e.preventDefault()):"Enter"===e.key&&null!=this.highlightedIndex&&(this.select(this.highlightedIndex),this.close()))}))}_unbindDocument(){document.removeEventListener("mousedown",this._docHandler),document.removeEventListener("touchstart",this._docHandler)}_move(e){const t=Array.from(this.menu.querySelectorAll(".dropdown-item"));0!==t.length&&(null==this.highlightedIndex?this.highlightedIndex=0:this.highlightedIndex=(this.highlightedIndex+e+t.length)%t.length,t.forEach(((e,t)=>{e.classList.toggle("highlighted",t===this.highlightedIndex)})),t[this.highlightedIndex].scrollIntoView({block:"nearest"}))}open(){if(this.isOpen)return;this.isOpen=!0;const e=this.button.getBoundingClientRect();this.menu.style.minWidth=e.width+"px",this.menu.style.left=e.left+window.scrollX+"px",this.menu.style.top=e.bottom+window.scrollY+"px",this.menu.style.display="block",this.highlightedIndex=this.selectedIndex;Array.from(this.menu.querySelectorAll(".dropdown-item")).forEach(((e,t)=>{e.classList.toggle("selected",t===this.selectedIndex)})),this._bindDocument(),this.menu.focus()}close(){this.isOpen&&(this.isOpen=!1,this.menu.style.display="none",this._unbindDocument(),this.button.focus())}toggle(){this.isOpen?this.close():this.open()}select(e){this.selectedIndex=e;const t=this.items[e],n=t.label??t;this.button.textContent=n;Array.from(this.menu.querySelectorAll(".dropdown-item")).forEach(((t,n)=>{t.classList.toggle("selected",n===e)})),this.onChange&&this.onChange(t,e)}}export function initDropdown(e,t,n){const s="string"==typeof e?document.getElementById(e):e;return new Dropdown(s,t,n)}