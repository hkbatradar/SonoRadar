export class Dropdown{constructor(t,e=[],{onChange:n}={}){this.button=t,this.items=e,this.onChange=n,this.menu=this._createMenu(),this.isOpen=!1,this.selectedIndex=-1,this._bindButton(),this.button&&(this.button._dropdown=this)}_createMenu(){const t=document.createElement("div");return t.className="dropdown-menu",t.tabIndex=-1,this.items.forEach(((e,n)=>{const s=document.createElement("div");s.className="dropdown-item",s.textContent=e.label??e,s.dataset.index=n,s.addEventListener("click",(()=>{this.select(n),this.close()})),t.appendChild(s)})),document.body.appendChild(t),t}_bindButton(){this.button.addEventListener("click",(t=>{this.button.disabled||(t.stopPropagation(),this.toggle())})),this.button.addEventListener("keydown",(t=>{this.button.disabled||"ArrowDown"!==t.key&&"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.open())}))}_bindDocument(){this._docHandler=t=>{this.menu.contains(t.target)||t.target===this.button||this.close()},document.addEventListener("mousedown",this._docHandler),document.addEventListener("touchstart",this._docHandler),document.addEventListener("keydown",(t=>{this.isOpen&&("Escape"===t.key?this.close():"ArrowDown"===t.key?(this._move(1),t.preventDefault()):"ArrowUp"===t.key?(this._move(-1),t.preventDefault()):"Enter"===t.key&&null!=this.highlightedIndex&&(this.select(this.highlightedIndex),this.close()))}))}_unbindDocument(){document.removeEventListener("mousedown",this._docHandler),document.removeEventListener("touchstart",this._docHandler)}_move(t){const e=Array.from(this.menu.querySelectorAll(".dropdown-item"));0!==e.length&&(null==this.highlightedIndex?this.highlightedIndex=0:this.highlightedIndex=(this.highlightedIndex+t+e.length)%e.length,e.forEach(((t,e)=>{t.classList.toggle("highlighted",e===this.highlightedIndex)})),e[this.highlightedIndex].scrollIntoView({block:"nearest"}))}open(){if(this.isOpen)return;this.isOpen=!0;const t=this.button.getBoundingClientRect();this.menu.style.minWidth=t.width+"px",this.menu.style.left=t.left+window.scrollX+"px",this.menu.style.top=t.bottom+window.scrollY+"px",this.menu.style.display="block",this.highlightedIndex=this.selectedIndex;Array.from(this.menu.querySelectorAll(".dropdown-item")).forEach(((t,e)=>{t.classList.toggle("selected",e===this.selectedIndex)})),this._bindDocument(),this.menu.focus()}close(){this.isOpen&&(this.isOpen=!1,this.menu.style.display="none",this._unbindDocument(),this.button.focus())}toggle(){this.isOpen?this.close():this.open()}select(t,e={triggerOnChange:!0}){if(t<0||t>=this.items.length)return;this.selectedIndex=t;const n=this.items[t],s=n.label??n;this.button&&(this.button.textContent=s);Array.from(this.menu.querySelectorAll(".dropdown-item")).forEach(((e,n)=>{const s=parseInt(e.dataset.index,10);e.classList.toggle("selected",s===t)})),e.triggerOnChange&&this.onChange&&this.onChange(n,t)}}export function initDropdown(t,e,n){const s="string"==typeof t?document.getElementById(t):t;return new Dropdown(s,e,n)}