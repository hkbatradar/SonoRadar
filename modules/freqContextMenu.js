window.handleCallTypeChange=window.handleCallTypeChange||function(){};export function initFreqContextMenu({viewerId:e,wrapperId:t="viewer-wrapper",containerId:n="spectrogram-only",spectrogramHeight:l=800,getDuration:o,getFreqRange:a,autoId:i}){const s=document.getElementById(e),d=document.getElementById(t),c=document.getElementById(n);if(!s||!d)return null;const r=document.createElement("div");r.id="freq-context-menu",r.className="freq-context-menu",r.style.display="none";const p={start:"Start freq.",end:"End freq.",high:"High freq.",low:"Low freq.",knee:"Knee freq.",heel:"Heel freq.",cfStart:"CF start",cfEnd:"CF end"},u=Object.keys(p);let m=null;u.forEach((e=>{const t=document.createElement("div");t.className="freq-menu-item",t.textContent=p[e],t.dataset.key=e,t.addEventListener("click",(()=>{if(t.classList.contains("disabled"))return;const n=m===e;w(),n?i&&"function"==typeof i.removeMarker&&i.removeMarker(e):i&&"function"==typeof i.setMarkerAt&&i.setMarkerAt(e,v,F)})),r.appendChild(t)}));const y=document.getElementById("callTypeInput"),g=y&&y._dropdown?y._dropdown.items:["CF-FM","FM-CF-FM","FM","FM-QCF","FM-QCF-FM","QCF"];let f=document.createElement("div");f.className="freq-context-menu freq-submenu",f.style.display="none",f.style.position="absolute",f.style.zIndex="1001",document.body.appendChild(f);let h=!1,C=null;function x(){f.style.display="none",h=!1}const E=document.createElement("div");E.className="freq-menu-item freq-menu-calltype",E.textContent="Call type",E.style.position="relative";const b=document.createElement("span");b.textContent=" >",b.style.position="absolute",b.style.right="8px",E.appendChild(b),E.addEventListener("click",(e=>{e.stopPropagation();const t=E.getBoundingClientRect();var n;n=document.getElementById("callTypeInput")?document.getElementById("callTypeInput")._dropdown?.selectedIndex:-1,f.innerHTML="",g.forEach(((e,t)=>{const l=document.createElement("div");l.className="freq-menu-item",l.textContent=e,n===t&&(l.style.fontWeight="bold",l.style.background="rgba(0,0,0,0.08)"),l.addEventListener("click",(()=>{window.handleCallTypeChange&&window.handleCallTypeChange(e,t);const n=document.getElementById("callTypeInput");n&&(n.textContent=e),x(),w()})),f.appendChild(l)})),function(e){f.style.display="block",h=!0,C=e;const t=d.getBoundingClientRect();let n=e.right,l=e.top;f.style.left=n+"px",f.style.top=l+"px";let o=f.getBoundingClientRect();o.bottom>t.bottom&&(l=Math.max(t.top,t.bottom-o.height),f.style.top=l+"px")}(t)})),r.appendChild(E);const q=document.createElement("div");q.className="freq-menu-item",q.textContent="Reset â†º",q.style.color="red",q.addEventListener("click",(()=>{w(),i&&"function"==typeof i.resetCurrentTab&&i.resetCurrentTab()})),r.appendChild(q),document.body.appendChild(r);let v=0,F=0;function w(){r.style.display="none",x(),m=null}return d.addEventListener("contextmenu",(e=>{if(!document.body.classList.contains("autoid-open"))return;if(e.target.closest("#zoom-controls"))return;const t=s.getBoundingClientRect(),n=e.clientX-t.left,y=e.clientY-t.top,g=c.scrollWidth>s.clientWidth?0:20,f=y>s.clientHeight-g,h=s.scrollHeight>s.clientHeight&&n>s.clientWidth;if(f||h)return;e.preventDefault(),e.stopImmediatePropagation();let C,E,b=null;if(e.target.classList.contains("freq-marker"))b=e.target.dataset.key,C=parseFloat(e.target.dataset.freq),E=parseFloat(e.target.dataset.time);else{const e=s.scrollLeft||0,{min:t,max:i}=a();C=(1-y/l)*(i-t)+t,E=(n+e)/c.scrollWidth*o()}!function(e,t,n,l,o=null){v=n,F=l,m=o,u.forEach((e=>{const t=r.querySelector(`[data-key="${e}"]`),n=!i||"function"==typeof i.isFieldEnabled&&i.isFieldEnabled(e);t.classList.toggle("disabled",!n),t.style.display=n?"block":"none",e===m?(t.textContent=`Delete ${p[e]}`,t.classList.add("delete")):(t.textContent=p[e],t.classList.remove("delete"))})),r.style.display="block",r.style.left=`${e}px`,r.style.top=`${t}px`;let a=r.getBoundingClientRect();const s=d.getBoundingClientRect();if(a.bottom>s.bottom){const e=t-a.height;r.style.top=`${Math.max(s.top,e)}px`,a=r.getBoundingClientRect()}if(a.right>s.right){const t=e-a.width;r.style.left=`${Math.max(s.left,t)}px`}x()}(e.clientX,e.clientY,C,E,b)})),document.addEventListener("mousedown",(e=>{0===e.button&&("none"===r.style.display&&"none"===f.style.display||r.contains(e.target)||f.contains(e.target)||w())})),{hide:w}}