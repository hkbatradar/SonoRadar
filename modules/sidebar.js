import{getFileList,getCurrentIndex,getFileIconState,getFileNote,setFileNote}from"./fileState.js";export function initSidebar({onFileSelected:e}={}){const t=document.getElementById("sidebar"),n=document.getElementById("toggleSidebarBtn"),l=(document.getElementById("sidebarIcon"),document.getElementById("fileList")),i=document.getElementById("searchInput"),a=document.getElementById("toggleEditBtn"),s=(document.getElementById("currentFilePath"),document.getElementById("fileCount"));let o=!1;function c(t="",n=!0){const i=getFileList(),a=getCurrentIndex();if(s){const e=`(Total: ${i.length.toLocaleString()} files)`;s.textContent=e}let o=null;l.innerHTML="",i.forEach(((n,i)=>{if(t&&!n.name.toLowerCase().includes(t))return;const s=document.createElement("li");s.style.padding="3px 0",s.style.cursor="pointer",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="space-between",s.style.flexWrap="nowrap";const c=n.name.replace(/\.wav$/i,""),d=document.createElement("span");d.style.display="flex",d.style.alignItems="center",d.style.flexGrow="1",d.style.minWidth="0",d.style.minHeight="20px";const r=document.createElement("i");r.className="fa-regular fa-file-audio",r.style.marginRight="6px",d.appendChild(r);const m=document.createElement("span");m.className="fileNameText",m.textContent=c,d.appendChild(m),s.appendChild(d);const p=document.createElement("span");p.style.display="flex",p.style.alignItems="center",p.style.flexShrink="0",p.style.whiteSpace="nowrap";const u=document.createElement("span");u.style.display="flex",u.style.flexShrink="0",u.style.whiteSpace="nowrap";const f=getFileIconState(i);if(f.trash){const e=document.createElement("i");e.className="fa-solid fa-trash",e.style.color="gray",e.style.marginLeft="4px",u.appendChild(e)}if(f.star){const e=document.createElement("i");e.className="fa-solid fa-star",e.style.color="#FFD700",e.style.marginLeft="4px",u.appendChild(e)}if(f.question){const e=document.createElement("i");e.className="fa-solid fa-question",e.style.color="red",e.style.marginLeft="4px",u.appendChild(e)}p.appendChild(u);const y=document.createElement("input");y.type="text",y.className="file-note-input",y.value=getFileNote(i),y.addEventListener("click",(e=>e.stopPropagation())),y.addEventListener("input",(e=>{setFileNote(i,e.target.value)})),p.appendChild(y),s.appendChild(p),s.addEventListener("click",(()=>{"function"==typeof e&&e(i)})),i===a&&(s.style.fontWeight="bold",s.style.color="#007bff",o=s),l.appendChild(s)})),o&&n&&requestAnimationFrame((()=>{o.scrollIntoView({block:"center",behavior:"smooth"})}))}return n.addEventListener("click",(()=>{t.classList.toggle("collapsed");const e=t.classList.contains("collapsed");n.title=e?"Open File List":"Collapse File List"})),a.addEventListener("click",(()=>{o=!o,t.classList.toggle("edit-mode",o),c(i.value.trim().toLowerCase(),!1)})),i.addEventListener("input",(()=>{c(i.value.trim().toLowerCase())})),{refresh:(e,t=!0)=>{!function(e){document.getElementById("fileNameText").textContent=e||"Upload wav file(s)"}(e),t&&(i.value=""),c(i.value.trim().toLowerCase())}}}
