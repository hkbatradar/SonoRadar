import{getFileList,getCurrentIndex,getFileIconState,getFileNote,setFileNote,toggleFileIcon}from"./fileState.js";export function initSidebar({onFileSelected:e}={}){const t=document.getElementById("sidebar"),n=document.getElementById("toggleSidebarBtn"),l=(document.getElementById("sidebarIcon"),document.getElementById("fileList")),s=document.getElementById("searchInput"),o=document.getElementById("toggleEditBtn"),a=(document.getElementById("currentFilePath"),document.getElementById("fileCount"));let i=!1;function c(t="",n=!0){const s=getFileList(),o=getCurrentIndex();if(a){const e=`(Total: ${s.length.toLocaleString()} files)`;a.textContent=e}let i=null;l.innerHTML="",s.forEach(((n,s)=>{if(t&&!n.name.toLowerCase().includes(t))return;const a=document.createElement("li");a.style.padding="3px 0",a.style.cursor="pointer",a.style.display="flex",a.style.alignItems="center",a.style.justifyContent="space-between",a.style.flexWrap="nowrap";const r=n.name.replace(/\.wav$/i,""),d=document.createElement("span");d.style.display="flex",d.style.alignItems="center",d.style.flexGrow="1",d.style.minWidth="0",d.style.minHeight="20px";const m=document.createElement("i");m.className="fa-regular fa-file-audio",m.style.marginRight="6px",d.appendChild(m);const p=document.createElement("span");p.className="fileNameText",p.textContent=r,d.appendChild(p),a.appendChild(d);const u=document.createElement("span");u.style.display="flex",u.style.alignItems="center",u.style.flexShrink="0",u.style.whiteSpace="nowrap";const g=document.createElement("span");g.style.display="flex",g.style.flexShrink="0",g.style.whiteSpace="nowrap";const y=getFileIconState(s),f=document.createElement("i");f.className="fa-solid fa-trash",f.style.marginLeft="4px",f.style.cursor="pointer",f.title="Mark as Trash (Delete)";const E="gray";f.style.color=y.trash?E:"#ccc",f.addEventListener("mouseenter",(()=>{y.trash||(f.style.color=E)})),f.addEventListener("mouseleave",(()=>{y.trash||(f.style.color="#ccc")})),f.addEventListener("click",(e=>{e.stopPropagation(),toggleFileIcon(s,"trash"),c(t,!1)})),g.appendChild(f);const h=document.createElement("i");h.className="fa-solid fa-star",h.style.marginLeft="4px",h.style.cursor="pointer",h.title="Mark as Star ( * button)";const L="#FFD700";h.style.color=y.star?L:"#ccc",h.addEventListener("mouseenter",(()=>{y.star||(h.style.color=L)})),h.addEventListener("mouseleave",(()=>{y.star||(h.style.color="#ccc")})),h.addEventListener("click",(e=>{e.stopPropagation(),toggleFileIcon(s,"star"),c(t,!1)})),g.appendChild(h);const v=document.createElement("i");v.className="fa-solid fa-question",v.style.marginLeft="4px",v.style.cursor="pointer",v.title="Mark as Question ( ? button)";v.style.color=y.question?"red":"#ccc",v.addEventListener("mouseenter",(()=>{y.question||(v.style.color="red")})),v.addEventListener("mouseleave",(()=>{y.question||(v.style.color="#ccc")})),v.addEventListener("click",(e=>{e.stopPropagation(),toggleFileIcon(s,"question"),c(t,!1)})),g.appendChild(v),u.appendChild(g);const x=document.createElement("input");x.type="text",x.className="file-note-input",x.value=getFileNote(s),x.addEventListener("click",(e=>e.stopPropagation())),x.addEventListener("input",(e=>{setFileNote(s,e.target.value)})),u.appendChild(x),a.appendChild(u),a.addEventListener("click",(()=>{"function"==typeof e&&e(s)})),s===o&&(a.style.fontWeight="bold",a.style.color="#007bff",i=a),l.appendChild(a)})),i&&n&&requestAnimationFrame((()=>{i.scrollIntoView({block:"center",behavior:"smooth"})}))}return n.addEventListener("click",(()=>{t.classList.toggle("collapsed");const e=t.classList.contains("collapsed");n.title=e?"Open File List":"Collapse File List"})),o.addEventListener("click",(()=>{i=!i,t.classList.toggle("edit-mode",i)})),s.addEventListener("input",(()=>{c(s.value.trim().toLowerCase())})),{refresh:(e,t=!0)=>{!function(e){document.getElementById("fileNameText").textContent=e||"Upload wav file(s)"}(e),t&&(s.value=""),c(s.value.trim().toLowerCase())}}}