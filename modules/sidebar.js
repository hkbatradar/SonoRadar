import{getFileList,getCurrentIndex,getFileIconState,getFileNote,setFileNote}from"./fileState.js";export function initSidebar({onFileSelected:e}={}){const t=document.getElementById("sidebar"),n=document.getElementById("toggleSidebarBtn"),l=(document.getElementById("sidebarIcon"),document.getElementById("fileList")),a=document.getElementById("searchInput"),i=document.getElementById("toggleEditBtn"),s=(document.getElementById("currentFilePath"),document.getElementById("fileCount"));let o=!1;function c(t=""){const n=getFileList(),a=getCurrentIndex();if(s){const e=`(Total: ${n.length.toLocaleString()} files)`;s.textContent=e}let i=null;l.innerHTML="",n.forEach(((n,s)=>{if(t&&!n.name.toLowerCase().includes(t))return;const o=document.createElement("li");o.style.padding="3px 0",o.style.cursor="pointer",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="space-between",o.style.flexWrap="nowrap";const c=n.name.replace(/\.wav$/i,""),d=document.createElement("span");d.style.display="flex",d.style.alignItems="center",d.style.flexGrow="1",d.style.minWidth="0";const r=document.createElement("i");r.className="fa-regular fa-file-audio",r.style.marginRight="6px",d.appendChild(r);const m=document.createElement("span");m.className="fileNameText",m.textContent=c,d.appendChild(m),o.appendChild(d);const p=document.createElement("span");p.style.display="flex",p.style.alignItems="center",p.style.flexShrink="0",p.style.whiteSpace="nowrap";const u=document.createElement("span");u.style.display="flex",u.style.flexShrink="0",u.style.whiteSpace="nowrap";const f=getFileIconState(s);if(f.trash){const e=document.createElement("i");e.className="fa-solid fa-trash",e.style.color="gray",e.style.marginLeft="4px",u.appendChild(e)}if(f.star){const e=document.createElement("i");e.className="fa-solid fa-star",e.style.color="#FFD700",e.style.marginLeft="4px",u.appendChild(e)}if(f.question){const e=document.createElement("i");e.className="fa-solid fa-question",e.style.color="red",e.style.marginLeft="4px",u.appendChild(e)}p.appendChild(u);const y=document.createElement("input");y.type="text",y.className="file-note-input",y.value=getFileNote(s),y.addEventListener("click",(e=>e.stopPropagation())),y.addEventListener("input",(e=>{setFileNote(s,e.target.value)})),p.appendChild(y),o.appendChild(p),o.addEventListener("click",(()=>{"function"==typeof e&&e(s)})),s===a&&(o.style.fontWeight="bold",o.style.color="#007bff",i=o),l.appendChild(o)})),i&&requestAnimationFrame((()=>{i.scrollIntoView({block:"center",behavior:"smooth"})}))}return n.addEventListener("click",(()=>{t.classList.toggle("collapsed");const e=t.classList.contains("collapsed");n.title=e?"Open File List":"Collapse File List"})),i.addEventListener("click",(()=>{o=!o,t.classList.toggle("edit-mode",o),c(a.value.trim().toLowerCase())})),a.addEventListener("input",(()=>{c(a.value.trim().toLowerCase())})),{refresh:(e,t=!0)=>{!function(e){document.getElementById("fileNameText").textContent=e||"Upload wav file(s)"}(e),t&&(a.value=""),c(a.value.trim().toLowerCase())}}}