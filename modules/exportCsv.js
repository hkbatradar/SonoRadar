import{getFileList,getFileIconState,getFileNote,getFileMetadata,setFileMetadata}from"./fileState.js";import{extractGuanoMetadata,parseGuanoMetadata}from"./guanoReader.js";async function generateCsvRows(){const t=getFileList(),e=[["File name","Remark","Date","Time","Latitude","Longitude","Noise","Star","Question"].join(",")];for(let a=0;a<t.length;a++){const o=t[a];let n=getFileMetadata(a);if(!n||!n.date&&!n.time&&!n.latitude&&!n.longitude)try{const t=await extractGuanoMetadata(o);n=parseGuanoMetadata(t),setFileMetadata(a,n)}catch(t){n={date:"",time:"",latitude:"",longitude:""}}const i=getFileIconState(a),d=getFileNote(a),s=[o.name,d,n.date,n.time,n.latitude,n.longitude,i.trash?"1":"0",i.star?"1":"0",i.question?"1":"0"].map((t=>`"${String(t).replace(/"/g,'""')}"`)).join(",");e.push(s)}return e}async function exportCsv(){const t=(await generateCsvRows()).join("\n"),e=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(e),o=document.createElement("a");o.href=a,o.download="export.csv",o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)}export function initExportCsv({buttonId:t="exportBtn"}={}){const e=document.getElementById(t);e?e.addEventListener("click",exportCsv):console.warn(`[exportCsv] Button with id '${t}' not found.`)}